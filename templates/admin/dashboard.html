<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°ç®¡ç† - æ§åˆ¶å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 24px;
        }
        .header-actions {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-primary {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        .btn-primary:hover {
            background: rgba(255,255,255,0.3);
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 14px;
        }
        .tab.active {
            background: #667eea;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .card {
            background: white;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .card h2 {
            margin-bottom: 15px;
            color: #333;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 5px;
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }
        .btn-danger {
            background: #e74c3c;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        .btn-success {
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-success:hover {
            background: #229954;
        }
        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .config-section h3 {
            margin-bottom: 15px;
            color: #333;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>ğŸ›ï¸ åå°ç®¡ç†ç³»ç»Ÿ</h1>
            <div class="header-actions">
                <span id="admin-username"></span>
                <button class="btn btn-primary" onclick="logout()">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('stats')">ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</button>
            <button class="tab" onclick="switchTab('ip')">ğŸš« IPé»‘åå•</button>
            <button class="tab" onclick="switchTab('interface')">ğŸ”Œ æ¥å£ç®¡ç†</button>
            <button class="tab" onclick="switchTab('settings')">âš™ï¸ ç³»ç»Ÿè®¾ç½®</button>
            <button class="tab" onclick="switchTab('announcement')">ğŸ“¢ å…¬å‘Šç®¡ç†</button>
            <button class="tab" onclick="switchTab('feedback')">ğŸ’¬ ç”¨æˆ·åé¦ˆ</button>
            <button class="tab" onclick="switchTab('users')">ğŸ‘¤ ç”¨æˆ·ç®¡ç†</button>
        </div>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div id="stats-tab" class="tab-content active">
            <div class="card">
                <h2>ğŸ“Š æ•°æ®ç»Ÿè®¡</h2>
                <div class="stats-grid" id="stats-grid">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
            <div class="card">
                <h2>ğŸŒ è®¿é—®IPç»Ÿè®¡ï¼ˆæœ€è¿‘7å¤©ï¼‰</h2>
                <table id="ip-stats-table">
                    <thead>
                        <tr>
                            <th>IPåœ°å€</th>
                            <th>è®¿é—®æ¬¡æ•°</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        
        <!-- IPé»‘åå• -->
        <div id="ip-tab" class="tab-content">
            <div class="card">
                <h2>ğŸš« IPé»‘åå•ç®¡ç†</h2>
                <form id="add-blacklist-form" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label>IPåœ°å€</label>
                        <input type="text" id="blacklist-ip" placeholder="ä¾‹å¦‚: 192.168.1.100" required>
                    </div>
                    <div class="form-group">
                        <label>æ‹‰é»‘åŸå› </label>
                        <textarea id="blacklist-reason" placeholder="è¯·è¾“å…¥æ‹‰é»‘åŸå› "></textarea>
                    </div>
                    <button type="submit" class="btn-success">æ·»åŠ åˆ°é»‘åå•</button>
                </form>
                <table id="blacklist-table">
                    <thead>
                        <tr>
                            <th>IPåœ°å€</th>
                            <th>æ‹‰é»‘åŸå› </th>
                            <th>åˆ›å»ºæ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        
        <!-- æ¥å£ç®¡ç† -->
        <div id="interface-tab" class="tab-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>ğŸ”Œ æ¥å£ç®¡ç†</h2>
                    <button class="btn btn-success" onclick="showInterfaceForm()">â• æ·»åŠ æ–°æ¥å£</button>
                </div>
                <div id="interface-list-content">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
        
        <!-- ç³»ç»Ÿè®¾ç½® -->
        <div id="settings-tab" class="tab-content">
            <div class="card">
                <h2>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h2>
                <div id="app-settings-content">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
        
        <!-- å…¬å‘Šç®¡ç† -->
        <div id="announcement-tab" class="tab-content">
            <div class="card">
                <h2>ğŸ“¢ å…¬å‘Šç®¡ç†</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showAnnouncementForm()">â• æ–°å»ºå…¬å‘Š</button>
                </div>
                <div id="announcement-stats" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
                <table id="announcement-table">
                    <thead>
                        <tr>
                            <th>æ ‡é¢˜</th>
                            <th>çŠ¶æ€</th>
                            <th>åˆ›å»ºæ—¶é—´</th>
                            <th>æ›´æ–°æ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- ç”¨æˆ·ç®¡ç† -->
        <div id="users-tab" class="tab-content">
            <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                    <h2>ğŸ‘¤ ç”¨æˆ·ç®¡ç†</h2>
                    <button class="btn btn-success" onclick="openUserModal()">â• æ·»åŠ ç”¨æˆ·</button>
                </div>
                <table id="users-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ç”¨æˆ·å</th>
                            <th>æ³¨å†Œæ—¶é—´</th>
                            <th>è§’è‰²</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="announcement-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="margin-bottom: 20px;">ç¼–è¾‘å…¬å‘Š</h2>
            <form id="announcement-form">
                <input type="hidden" id="announcement-id">
                <div class="form-group">
                    <label>æ ‡é¢˜ <span style="color: red;">*</span></label>
                    <input type="text" id="announcement-title" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>å†…å®¹ <span style="color: red;">*</span></label>
                    <textarea id="announcement-content" required rows="10" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit;"></textarea>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>
                        <input type="checkbox" id="announcement-active"> å¯ç”¨å…¬å‘Š
                    </label>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">å¯ç”¨åï¼Œæ–°è®¿é—®çš„IPå°†çœ‹åˆ°æ­¤å…¬å‘Šã€‚å¯ç”¨æ–°å…¬å‘Šä¼šè‡ªåŠ¨ç¦ç”¨å…¶ä»–å…¬å‘Šã€‚</p>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn" onclick="closeAnnouncementModal()" style="background: #f0f0f0;">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç”¨æˆ·åˆ›å»ºæ¨¡æ€æ¡† -->
    <div id="user-modal" style="display:none; position: fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
        <div style="background:white; padding:30px; border-radius:10px; max-width:400px; width:90%;">
            <h2 style="margin-bottom:20px;">â• æ·»åŠ ç”¨æˆ·</h2>
            <form id="user-form">
                <div class="form-group">
                    <label>ç”¨æˆ·å <span style="color:red;">*</span></label>
                    <input type="text" id="user-username" required placeholder="è¯·è¾“å…¥ç”¨æˆ·å" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                </div>
                <div class="form-group" style="margin-top:15px;">
                    <label>å¯†ç  <span style="color:red;">*</span></label>
                    <input type="password" id="user-password" required placeholder="è‡³å°‘6ä½" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                </div>
                <div class="form-group" style="margin-top:15px;">
                    <label>ç¡®è®¤å¯†ç  <span style="color:red;">*</span></label>
                    <input type="password" id="user-password-confirm" required placeholder="å†æ¬¡è¾“å…¥å¯†ç " style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                </div>
                <div style="margin-top:20px; display:flex; justify-content:flex-end; gap:10px;">
                    <button type="button" class="btn" onclick="closeUserModal()" style="background:#f0f0f0;">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ç”¨æˆ·åé¦ˆ -->
    <div id="feedback-tab" class="tab-content">
        <div class="card">
            <h2>ğŸ’¬ ç”¨æˆ·åé¦ˆç®¡ç†</h2>
            <div id="feedback-stats" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
            <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
                <label>ç­›é€‰çŠ¶æ€ï¼š</label>
                <select id="feedback-status-filter" onchange="loadFeedbacks()" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">å…¨éƒ¨</option>
                    <option value="pending">å¾…å¤„ç†</option>
                    <option value="processed">å·²å¤„ç†</option>
                </select>
            </div>
            <table id="feedback-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>åé¦ˆå†…å®¹</th>
                        <th>è”ç³»æ–¹å¼</th>
                        <th>ç”¨æˆ·/IP</th>
                        <th>çŠ¶æ€</th>
                        <th>æäº¤æ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div id="feedback-pagination" style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;"></div>
        </div>
    </div>
    
    <!-- æ¥å£ç®¡ç†æ¨¡æ€æ¡† -->
    <div id="interface-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto;">
        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; margin: 20px;">
            <h2 style="margin-bottom: 20px;" id="interface-modal-title">æ·»åŠ æ–°æ¥å£</h2>
            <form id="interface-form">
                <input type="hidden" id="interface-name-old">
                
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="form-group">
                        <label>æ¥å£åç§°ï¼ˆè‹±æ–‡ï¼Œå¦‚ï¼šco1ï¼‰ <span style="color: red;">*</span></label>
                        <input type="text" id="interface-name" placeholder="ä¾‹å¦‚: co1" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666;">åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿</small>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>æ˜¾ç¤ºåç§° <span style="color: red;">*</span></label>
                        <input type="text" id="interface-display-name" placeholder="ä¾‹å¦‚: CO1æ¥å£" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>æ¥å£æè¿°</label>
                        <textarea id="interface-description" rows="2" placeholder="æ¥å£è¯´æ˜" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>
                            <input type="checkbox" id="interface-enabled" checked> å¯ç”¨æ¥å£
                        </label>
                    </div>
                </div>
                
                <!-- æ¥å£URLé…ç½® -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">æ¥å£URLé…ç½® <span style="color: red;">*</span></h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">é…ç½®æ¥å£çš„è¯·æ±‚åœ°å€ã€‚ä½¿ç”¨ {keyword}ã€{bookId}ã€{chapterId}ã€{page}ã€{size}ã€{timestamp} ç­‰ä½œä¸ºå ä½ç¬¦ã€‚</p>
                    
                    <!-- æœç´¢æ¥å£URL -->
                    <div style="margin-bottom: 20px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: white;">
                        <h4 style="margin-bottom: 10px;">ğŸ“š æœç´¢æ¥å£URL <span style="color: red;">*</span></h4>
                        <div class="form-group">
                            <label>è¯·æ±‚æ–¹æ³•</label>
                            <select id="url-search-method" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-top: 10px;">
                            <label>æ¥å£URL</label>
                            <textarea id="url-search-url" rows="2" placeholder="https://api.example.com/search?keyword={keyword}" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                            <small style="color: #666;">ç¤ºä¾‹ï¼šhttps://api.example.com/search?q={keyword} æˆ– https://api.example.com/searchï¼ˆPOSTè¯·æ±‚ï¼‰</small>
                        </div>
                    </div>
                    
                    <!-- ç« èŠ‚åˆ—è¡¨æ¥å£URL -->
                    <div style="margin-bottom: 20px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: white;">
                        <h4 style="margin-bottom: 10px;">ğŸ“– ç« èŠ‚åˆ—è¡¨æ¥å£URL <span style="color: red;">*</span></h4>
                        <div class="form-group">
                            <label>è¯·æ±‚æ–¹æ³•</label>
                            <select id="url-chapters-method" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-top: 10px;">
                            <label>æ¥å£URL</label>
                            <textarea id="url-chapters-url" rows="2" placeholder="https://api.example.com/book/{bookId}/chapters?page={page}&size={size}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                            <small style="color: #666;">ç¤ºä¾‹ï¼šhttps://api.example.com/chapters?bookId={bookId}&page={page}&size={size}</small>
                        </div>
                    </div>
                    
                    <!-- éŸ³é¢‘URLæ¥å£ -->
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: white;">
                        <h4 style="margin-bottom: 10px;">ğŸµ éŸ³é¢‘URLæ¥å£ <span style="color: red;">*</span></h4>
                        <div class="form-group">
                            <label>è¯·æ±‚æ–¹æ³•</label>
                            <select id="url-audio-method" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-top: 10px;">
                            <label>æ¥å£URL</label>
                            <textarea id="url-audio-url" rows="2" placeholder="https://api.example.com/audio?bookId={bookId}&chapterId={chapterId}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                            <small style="color: #666;">ç¤ºä¾‹ï¼šhttps://api.example.com/audio/{bookId}/{chapterId} æˆ– https://api.example.com/getAudioï¼ˆPOSTè¯·æ±‚ï¼‰</small>
                        </div>
                    </div>
                </div>
                
                <!-- å­—æ®µæ˜ å°„é…ç½® -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">å­—æ®µæ˜ å°„é…ç½®</h3>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">é…ç½®å¦‚ä½•ä»æ¥å£è¿”å›å€¼ä¸­æå–æ•°æ®ã€‚å¦‚æœæ¥å£è¿”å›æ ¼å¼å’Œlam/ttç›¸åŒï¼Œå¯ä»¥ç•™ç©ºä½¿ç”¨é»˜è®¤å€¼ã€‚</p>
                    
                    <!-- æœç´¢æ¥å£å­—æ®µæ˜ å°„ -->
                    <div style="margin-bottom: 20px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: white;">
                        <h4 style="margin-bottom: 10px;">ğŸ“š æœç´¢æ¥å£å­—æ®µæ˜ å°„</h4>
                        <div class="form-group">
                            <label>æˆåŠŸæ ‡è¯†å­—æ®µåï¼ˆå¦‚ï¼šstatusã€codeã€successï¼‰</label>
                            <input type="text" id="field-search-success-field" placeholder="status" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group" style="margin-top: 10px;">
                            <label>æˆåŠŸå€¼ï¼ˆå¦‚ï¼š0ã€200ã€trueï¼‰</label>
                            <input type="text" id="field-search-success-value" placeholder="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group" style="margin-top: 10px;">
                            <label>æ•°æ®åˆ—è¡¨è·¯å¾„ï¼ˆå¦‚ï¼šdata.bookDataã€data.listï¼‰</label>
                            <input type="text" id="field-search-data-path" placeholder="data.bookData" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <small style="color: #666;">ä½¿ç”¨ç‚¹å·åˆ†éš”åµŒå¥—è·¯å¾„ï¼Œå¦‚ data.list è¡¨ç¤º data['list']</small>
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div>
                                    <strong>å­—æ®µæ˜ å°„ï¼ˆæ ‡å‡†å­—æ®µå: æ¥å£è¿”å›å­—æ®µåï¼‰</strong>
                                    <small style="display: block; color: #666; margin-top: 3px;">
                                        ğŸ’¡ æ ‡å‡†å­—æ®µåæ˜¯ç³»ç»Ÿå›ºå®šçš„å­—æ®µåï¼Œç”¨äºç»Ÿä¸€æ•°æ®æ ¼å¼ã€‚å¸¸ç”¨å­—æ®µï¼šid, bookTitle, bookName, bookAnchor, bookImage, bookDesc, count, heat
                                    </small>
                                </div>
                                <button type="button" onclick="addSearchField()" style="padding: 5px 10px; background: #27ae60; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">+ æ·»åŠ å­—æ®µ</button>
                            </div>
                            <div id="search-fields-container" style="display: flex; flex-direction: column; gap: 8px;">
                                <!-- åŠ¨æ€å­—æ®µè¡Œå°†é€šè¿‡JavaScriptæ·»åŠ  -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç« èŠ‚åˆ—è¡¨å­—æ®µæ˜ å°„ -->
                    <div style="margin-bottom: 20px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: white;">
                        <h4 style="margin-bottom: 10px;">ğŸ“– ç« èŠ‚åˆ—è¡¨å­—æ®µæ˜ å°„</h4>
                        <div class="form-group">
                            <label>æˆåŠŸæ ‡è¯†å­—æ®µå</label>
                            <input type="text" id="field-chapters-success-field" placeholder="status" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group" style="margin-top: 10px;">
                            <label>æˆåŠŸå€¼</label>
                            <input type="text" id="field-chapters-success-value" placeholder="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group" style="margin-top: 10px;">
                            <label>ç« èŠ‚åˆ—è¡¨è·¯å¾„</label>
                            <input type="text" id="field-chapters-data-path" placeholder="data.list" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div>
                                    <strong>ç« èŠ‚å­—æ®µæ˜ å°„</strong>
                                    <small style="display: block; color: #666; margin-top: 3px;">
                                        ğŸ’¡ æ ‡å‡†å­—æ®µåæ˜¯ç³»ç»Ÿå›ºå®šçš„å­—æ®µåã€‚å¸¸ç”¨å­—æ®µï¼šchapter_id, title, duration, order
                                    </small>
                                </div>
                                <button type="button" onclick="addChaptersField()" style="padding: 5px 10px; background: #27ae60; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">+ æ·»åŠ å­—æ®µ</button>
                            </div>
                            <div id="chapters-fields-container" style="display: flex; flex-direction: column; gap: 8px;">
                                <!-- åŠ¨æ€å­—æ®µè¡Œå°†é€šè¿‡JavaScriptæ·»åŠ  -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- éŸ³é¢‘URLå­—æ®µæ˜ å°„ -->
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: white;">
                        <h4 style="margin-bottom: 10px;">ğŸµ éŸ³é¢‘URLå­—æ®µæ˜ å°„</h4>
                        <div class="form-group">
                            <label>æˆåŠŸæ ‡è¯†å­—æ®µå</label>
                            <input type="text" id="field-url-success-field" placeholder="status" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group" style="margin-top: 10px;">
                            <label>æˆåŠŸå€¼</label>
                            <input type="text" id="field-url-success-value" placeholder="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group" style="margin-top: 10px;">
                            <label>éŸ³é¢‘URLå­—æ®µåï¼ˆå¦‚ï¼šsrcã€urlã€audio_urlï¼‰</label>
                            <input type="text" id="field-url-url-field" placeholder="src" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn" onclick="closeInterfaceModal()" style="background: #f0f0f0;">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¿å­˜æ¥å£</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- åé¦ˆè¯¦æƒ…/å¤„ç†æ¨¡æ€æ¡† -->
    <div id="feedback-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="margin-bottom: 20px;">åé¦ˆè¯¦æƒ…</h2>
            <div id="feedback-detail-content">
                <div class="form-group">
                    <label>åé¦ˆå†…å®¹ï¼š</label>
                    <div id="feedback-detail-content-text" style="padding: 10px; background: #f8f9fa; border-radius: 4px; margin-top: 5px; white-space: pre-wrap; word-wrap: break-word;"></div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>è”ç³»æ–¹å¼ï¼š</label>
                    <div id="feedback-detail-contact" style="padding: 10px; background: #f8f9fa; border-radius: 4px; margin-top: 5px;"></div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>æäº¤ä¿¡æ¯ï¼š</label>
                    <div id="feedback-detail-info" style="padding: 10px; background: #f8f9fa; border-radius: 4px; margin-top: 5px; font-size: 14px; color: #666;"></div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>å¤„ç†å¤‡æ³¨ï¼š</label>
                    <textarea id="feedback-remark" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;"></textarea>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn" onclick="closeFeedbackModal()" style="background: #f0f0f0;">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-success" onclick="processFeedback()" id="process-feedback-btn">æ ‡è®°ä¸ºå·²å¤„ç†</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'ip') {
                loadBlacklist();
            } else if (tabName === 'interface') {
                loadInterfaceList();
            } else if (tabName === 'settings') {
                loadAppSettings();
            } else if (tabName === 'announcement') {
                loadAnnouncements();
            } else if (tabName === 'feedback') {
                loadFeedbacks();
            }
        }
        
        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        async function loadStats() {
            try {
                const response = await fetch('/admin/api/stats');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('stats-grid').innerHTML = `
                        <div class="stat-card">
                            <div class="stat-value">${stats.total_users}</div>
                            <div class="stat-label">æ€»æ³¨å†Œäººæ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.today_users}</div>
                            <div class="stat-label">ä»Šæ—¥æ³¨å†Œ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.today_ip_count}</div>
                            <div class="stat-label">ä»Šæ—¥è®¿é—®IP</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.total_access}</div>
                            <div class="stat-label">7å¤©æ€»è®¿é—®</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.blacklist_count}</div>
                            <div class="stat-label">é»‘åå•æ•°é‡</div>
                        </div>
                    `;
                    
                    // æ˜¾ç¤ºIPç»Ÿè®¡
                    const tbody = document.querySelector('#ip-stats-table tbody');
                    tbody.innerHTML = data.ip_list.map(item => `
                        <tr>
                            <td>${item.ip}</td>
                            <td>${item.count}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½é»‘åå•
        async function loadBlacklist() {
            try {
                const response = await fetch('/admin/api/ip-blacklist');
                const data = await response.json();
                
                if (data.success) {
                    const tbody = document.querySelector('#blacklist-table tbody');
                    tbody.innerHTML = data.blacklist.map(item => `
                        <tr>
                            <td>${item.ip_address}</td>
                            <td>${item.reason || '-'}</td>
                            <td>${new Date(item.create_time).toLocaleString('zh-CN')}</td>
                            <td>
                                <button class="btn-danger" onclick="removeBlacklist(${item.id})">ç§»é™¤</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('åŠ è½½é»‘åå•å¤±è´¥:', error);
            }
        }
        
        // æ·»åŠ é»‘åå•
        document.getElementById('add-blacklist-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const ip = document.getElementById('blacklist-ip').value.trim();
            const reason = document.getElementById('blacklist-reason').value.trim();
            
            try {
                const response = await fetch('/admin/api/ip-blacklist', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ip_address: ip, reason: reason})
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('å·²æ·»åŠ åˆ°é»‘åå•');
                    document.getElementById('add-blacklist-form').reset();
                    loadBlacklist();
                } else {
                    alert(data.error || 'æ·»åŠ å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        });
        
        // ç§»é™¤é»‘åå•
        async function removeBlacklist(id) {
            if (!confirm('ç¡®å®šè¦ç§»é™¤è¿™ä¸ªIPå—ï¼Ÿ')) return;
            
            try {
                const response = await fetch(`/admin/api/ip-blacklist/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('å·²ç§»é™¤');
                    loadBlacklist();
                } else {
                    alert(data.error || 'ç§»é™¤å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }
        
        // åŠ è½½åº”ç”¨è®¾ç½®
        async function loadAppSettings() {
            try {
                const response = await fetch('/admin/api/app-config');
                const data = await response.json();
                
                if (data.success) {
                    const config = data.config || {};
                    const mobileOnly = !!config.mobile_only_access;
                    const allowRegister = (config.allow_register !== false); // é»˜è®¤ä¸ºå¼€æ”¾æ³¨å†Œ
                    const html = `
                        <div style="max-width: 600px;">
                            <div style="margin-bottom: 30px;">
                                <h3 style="margin-bottom: 10px;">ğŸ“± æ‰‹æœºç‰ˆè®¿é—®é™åˆ¶</h3>
                                <p style="color: #666; margin-bottom: 20px;">å¼€å¯åï¼Œåªæœ‰æ‰‹æœºè®¾å¤‡æ‰èƒ½è®¿é—®ç½‘ç«™ï¼Œç”µè„‘ç­‰éæ‰‹æœºè®¾å¤‡å°†è¢«æ‹’ç»è®¿é—®ã€‚</p>
                                <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                    <label style="display: flex; align-items: center; cursor: pointer; flex: 1;">
                                        <input type="checkbox" id="mobile-only-access" ${mobileOnly ? 'checked' : ''} 
                                            style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;">
                                        <span style="font-size: 16px; font-weight: 500;">ä»…å…è®¸æ‰‹æœºè®¾å¤‡è®¿é—®</span>
                                    </label>
                                </div>
                                <div style="margin-top: 15px; padding: 12px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">
                                    <strong>âš ï¸ æ³¨æ„äº‹é¡¹ï¼š</strong>
                                    <ul style="margin: 10px 0 0 20px; color: #856404;">
                                        <li>å¼€å¯åï¼Œç®¡ç†å‘˜åå°ä¸å—é™åˆ¶ï¼ˆå¯ä»ä»»ä½•è®¾å¤‡è®¿é—®ï¼‰</li>
                                        <li>é™æ€èµ„æºï¼ˆCSSã€JSã€å›¾ç‰‡ç­‰ï¼‰ä¸å—é™åˆ¶</li>
                                        <li>æ‰‹æœºè®¾å¤‡æ£€æµ‹åŸºäºæµè§ˆå™¨ User-Agentï¼ŒæŸäº›æ¨¡æ‹Ÿå™¨å¯èƒ½æ— æ³•é€šè¿‡æ£€æµ‹</li>
                                    </ul>
                                </div>
                            </div>
                            <div style="margin-bottom: 30px;">
                                <h3 style="margin-bottom: 10px;">ğŸ‘¥ ç”¨æˆ·æ³¨å†Œæ§åˆ¶</h3>
                                <p style="color: #666; margin-bottom: 20px;">å¯ä»¥å¿«é€Ÿå¼€å¯æˆ–å…³é—­å‰å°ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ã€‚</p>
                                <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                    <label style="display: flex; align-items: center; cursor: pointer; flex: 1;">
                                        <input type="checkbox" id="allow-register" ${allowRegister ? 'checked' : ''} 
                                            style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;">
                                        <span style="font-size: 16px; font-weight: 500;">å…è®¸å‰å°ç”¨æˆ·æ³¨å†Œ</span>
                                    </label>
                                </div>
                                <div style="margin-top: 15px; padding: 12px; background: #e9f7ef; border-left: 4px solid #27ae60; border-radius: 4px;">
                                    <ul style="margin: 0 0 0 20px; color: #145a32;">
                                        <li>å…³é—­åï¼Œæ³¨å†Œæ¥å£ä¼šè¿”å›â€œå½“å‰å·²å…³é—­æ³¨å†Œï¼Œè¯·è”ç³»ç®¡ç†å‘˜å¼€é€šâ€</li>
                                        <li>å‰å°â€œæ³¨å†Œâ€æŒ‰é’®å¯ä»¥æŒ‰éœ€éšè—ï¼ˆå¦‚éœ€è¦ä¹Ÿå¯ä»¥å†è°ƒæ•´å‰ç«¯ï¼‰</li>
                                    </ul>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <button class="btn btn-success" onclick="saveAppSettings()" style="padding: 10px 20px;">
                                    ğŸ’¾ ä¿å­˜è®¾ç½®
                                </button>
                            </div>
                        </div>
                    `;
                    document.getElementById('app-settings-content').innerHTML = html;
                } else {
                    document.getElementById('app-settings-content').innerHTML = 
                        '<div class="error">åŠ è½½è®¾ç½®å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
                }
            } catch (error) {
                console.error('åŠ è½½åº”ç”¨è®¾ç½®å¤±è´¥:', error);
                document.getElementById('app-settings-content').innerHTML = 
                    '<div class="error">åŠ è½½è®¾ç½®å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        }
        
        // ä¿å­˜åº”ç”¨è®¾ç½®
        async function saveAppSettings() {
            try {
                const mobileOnlyAccess = document.getElementById('mobile-only-access').checked;
                const allowRegister = document.getElementById('allow-register').checked;
                
                const response = await fetch('/admin/api/app-config', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        mobile_only_access: mobileOnlyAccess,
                        allow_register: allowRegister
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('âœ… è®¾ç½®å·²ä¿å­˜æˆåŠŸï¼');
                    loadAppSettings(); // é‡æ–°åŠ è½½ä»¥ç¡®è®¤
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                console.error('ä¿å­˜åº”ç”¨è®¾ç½®å¤±è´¥:', error);
                alert('âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
            }
        }
        
        // åŠ è½½APIé…ç½®
        async function loadAPIConfig() {
            try {
                const response = await fetch('/admin/api/api-config');
                const data = await response.json();
                
                if (data.success) {
                    const configs = data.configs;
                    let html = '';
                    
                    // LAMæ¥å£é…ç½®
                    html += '<div class="config-section"><h3>ğŸ“¡ LAMæ¥å£é…ç½®</h3>';
                    html += createConfigForm('lam', 'search', configs.lam_search || {}, 'æœç´¢æ¥å£');
                    html += createConfigForm('lam', 'chapters', configs.lam_chapters || {}, 'ç« èŠ‚åˆ—è¡¨æ¥å£');
                    html += createConfigForm('lam', 'url', configs.lam_url || {}, 'æ’­æ”¾URLæ¥å£');
                    html += '</div>';
                    
                    // TTæ¥å£é…ç½®
                    html += '<div class="config-section"><h3>ğŸ“¡ TTæ¥å£é…ç½®</h3>';
                    html += createConfigForm('tt', 'search', configs.tt_search || {}, 'æœç´¢æ¥å£');
                    html += createConfigForm('tt', 'chapters', configs.tt_chapters || {}, 'ç« èŠ‚åˆ—è¡¨æ¥å£');
                    html += createConfigForm('tt', 'url', configs.tt_url || {}, 'æ’­æ”¾URLæ¥å£');
                    html += '</div>';
                    
                    document.getElementById('api-config-content').innerHTML = html;
                    
                    // ç»‘å®šä¿å­˜äº‹ä»¶
                    document.querySelectorAll('.save-config-btn').forEach(btn => {
                        btn.addEventListener('click', saveConfig);
                    });
                }
            } catch (error) {
                console.error('åŠ è½½APIé…ç½®å¤±è´¥:', error);
            }
        }
        
        // åˆ›å»ºé…ç½®è¡¨å•
        function createConfigForm(interface, type, config, label) {
            const defaultConfigs = {
                'lam_search': {url: 'https://app.365ting.com/listen/Apitzg2025/appSearch?app_token=abcSEARCH-2025&client=babala-android&search={keyword}'},
                'lam_chapters': {url: 'https://app.365ting.com/listen/Apitzg2025/chapter?bookId={bookId}&page={page}&size={size}&sort=asc'},
                'lam_url': {url: 'https://app.365ting.com/listen/Apitzg2025/AppGetChapterUrl2023?addItParapet=502aa1c2730221d52c71fa3359425e52&bookId={bookId}&chapterId={chapterId}&timeStamp={timestamp}&uid='},
                'tt_search': {url: 'https://sdkapi.hhlqilongzhu.cn/api/ximalaya/?key=DragonD4E8CEDD0B41A3B59B777BE08933F65B&name={keyword}'},
                'tt_chapters': {url: 'https://mobile.ximalaya.com/mobile/v1/album/track/ts-{timestamp}?albumId={bookId}&pageId={page}&pageSize={size}&device=android&isAsc=true'},
                'tt_url': {url: 'https://sdkapi.hhlqilongzhu.cn/api/ximalaya/?key=DragonD4E8CEDD0B41A3B59B777BE08933F65B&trackId={trackId}'}
            };
            
            const key = `${interface}_${type}`;
            const defaultConfig = defaultConfigs[key] || {};
            const currentConfig = config._url || config.url || defaultConfig.url || '';
            
            return `
                <div style="margin-bottom: 20px;">
                    <h4>${label}</h4>
                    <div class="form-group">
                        <label>æ¥å£URLï¼ˆä½¿ç”¨{keyword}ã€{bookId}ã€{chapterId}ç­‰ä½œä¸ºå ä½ç¬¦ï¼‰</label>
                        <textarea id="config_${interface}_${type}" rows="3">${currentConfig}</textarea>
                    </div>
                    <button type="button" class="btn-success save-config-btn" data-interface="${interface}" data-type="${type}">ä¿å­˜é…ç½®</button>
                </div>
            `;
        }
        
        // ä¿å­˜é…ç½®
        async function saveConfig() {
            const btn = event.target;
            const interface = btn.dataset.interface;
            const type = btn.dataset.type;
            const url = document.getElementById(`config_${interface}_${type}`).value.trim();
            
            if (!url) {
                alert('URLä¸èƒ½ä¸ºç©º');
                return;
            }
            
            try {
                const response = await fetch('/admin/api/api-config', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        interface: interface,
                        config_type: type,
                        config: {_url: url}
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('é…ç½®å·²ä¿å­˜');
                } else {
                    alert(data.error || 'ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }
        
        // é€€å‡ºç™»å½•
        async function logout() {
            try {
                await fetch('/admin/logout', {method: 'POST'});
                window.location.href = '/admin';
            } catch (error) {
                window.location.href = '/admin';
            }
        }
        
        // åŠ è½½å…¬å‘Šåˆ—è¡¨
        async function loadAnnouncements() {
            try {
                const response = await fetch('/admin/api/announcement');
                const data = await response.json();
                
                if (data.success) {
                    renderAnnouncements(data.announcements);
                    loadAnnouncementStats();
                } else {
                    alert(data.error || 'åŠ è½½å…¬å‘Šå¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }
        
        // æ¸²æŸ“å…¬å‘Šåˆ—è¡¨
        function renderAnnouncements(announcements) {
            const tbody = document.querySelector('#announcement-table tbody');
            if (announcements.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">æš‚æ— å…¬å‘Š</td></tr>';
                return;
            }
            
            tbody.innerHTML = announcements.map(ann => {
                const createTime = new Date(ann.create_time).toLocaleString('zh-CN');
                const updateTime = new Date(ann.update_time).toLocaleString('zh-CN');
                return `
                    <tr>
                        <td>${ann.title}</td>
                        <td>${ann.is_active ? '<span style="color: green;">âœ“ å¯ç”¨</span>' : '<span style="color: #999;">ç¦ç”¨</span>'}</td>
                        <td>${createTime}</td>
                        <td>${updateTime}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editAnnouncement(${ann.id})" style="padding: 5px 10px; font-size: 12px;">ç¼–è¾‘</button>
                            <button class="btn" onclick="deleteAnnouncement(${ann.id})" style="padding: 5px 10px; font-size: 12px; background: #f44336; color: white;">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // åŠ è½½å…¬å‘Šç»Ÿè®¡
        async function loadAnnouncementStats() {
            try {
                const response = await fetch('/admin/api/announcement/stats');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('announcement-stats').innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;">${stats.total_announcements}</div>
                                <div style="color: #666; font-size: 14px;">æ€»å…¬å‘Šæ•°</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #2ecc71;">${stats.active_announcements}</div>
                                <div style="color: #666; font-size: 14px;">å¯ç”¨å…¬å‘Š</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #f39c12;">${stats.total_confirms}</div>
                                <div style="color: #666; font-size: 14px;">æ€»ç¡®è®¤æ•°</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #e74c3c;">${stats.recent_confirms}</div>
                                <div style="color: #666; font-size: 14px;">æœ€è¿‘7å¤©ç¡®è®¤</div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½å…¬å‘Šç»Ÿè®¡å¤±è´¥', error);
            }
        }
        
        // æ˜¾ç¤ºå…¬å‘Šè¡¨å•
        function showAnnouncementForm() {
            document.getElementById('announcement-id').value = '';
            document.getElementById('announcement-title').value = '';
            document.getElementById('announcement-content').value = '';
            document.getElementById('announcement-active').checked = true;
            document.getElementById('announcement-modal').style.display = 'flex';
        }
        
        // ç¼–è¾‘å…¬å‘Š
        async function editAnnouncement(id) {
            try {
                const response = await fetch('/admin/api/announcement');
                const data = await response.json();
                
                if (data.success) {
                    const announcement = data.announcements.find(a => a.id === id);
                    if (announcement) {
                        document.getElementById('announcement-id').value = announcement.id;
                        document.getElementById('announcement-title').value = announcement.title;
                        document.getElementById('announcement-content').value = announcement.content;
                        document.getElementById('announcement-active').checked = announcement.is_active;
                        document.getElementById('announcement-modal').style.display = 'flex';
                    }
                }
            } catch (error) {
                alert('åŠ è½½å…¬å‘Šå¤±è´¥');
            }
        }
        
        // å…³é—­å…¬å‘Šæ¨¡æ€æ¡†
        function closeAnnouncementModal() {
            document.getElementById('announcement-modal').style.display = 'none';
        }
        
        // ä¿å­˜å…¬å‘Š
        document.getElementById('announcement-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const id = document.getElementById('announcement-id').value;
            const title = document.getElementById('announcement-title').value.trim();
            const content = document.getElementById('announcement-content').value.trim();
            const is_active = document.getElementById('announcement-active').checked;
            
            if (!title || !content) {
                alert('æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
                return;
            }
            
            try {
                let url = '/admin/api/announcement';
                let method = 'POST';
                
                if (id) {
                    url = `/admin/api/announcement/${id}`;
                    method = 'PUT';
                }
                
                const response = await fetch(url, {
                    method: method,
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({title, content, is_active})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('ä¿å­˜æˆåŠŸ');
                    closeAnnouncementModal();
                    loadAnnouncements();
                } else {
                    alert(data.error || 'ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        });
        
        // åˆ é™¤å…¬å‘Š
        async function deleteAnnouncement(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤æ­¤å…¬å‘Šå—ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/api/announcement/${id}`, {method: 'DELETE'});
                const data = await response.json();
                
                if (data.success) {
                    alert('åˆ é™¤æˆåŠŸ');
                    loadAnnouncements();
                } else {
                    alert(data.error || 'åˆ é™¤å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }
        
        // åé¦ˆç®¡ç†ç›¸å…³å˜é‡
        let currentFeedbackPage = 1;
        let currentFeedbackId = null;
        
        // åŠ è½½åé¦ˆåˆ—è¡¨
        async function loadFeedbacks(page = 1) {
            currentFeedbackPage = page;
            const status = document.getElementById('feedback-status-filter').value;
            
            try {
                const url = `/admin/api/feedback?page=${page}&per_page=20${status ? '&status=' + status : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    renderFeedbacks(data.feedbacks);
                    renderFeedbackPagination(data.pagination);
                    loadFeedbackStats();
                } else {
                    alert(data.error || 'åŠ è½½åé¦ˆå¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½åé¦ˆå¤±è´¥:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°');
            }
        }
        
        // æ¸²æŸ“åé¦ˆåˆ—è¡¨
        function renderFeedbacks(feedbacks) {
            const tbody = document.querySelector('#feedback-table tbody');
            if (feedbacks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;">æš‚æ— åé¦ˆ</td></tr>';
                return;
            }
            
            tbody.innerHTML = feedbacks.map(fb => {
                const createTime = new Date(fb.create_time).toLocaleString('zh-CN');
                const contentPreview = fb.content.length > 50 ? fb.content.substring(0, 50) + '...' : fb.content;
                const userInfo = fb.user_id ? `ç”¨æˆ·ID: ${fb.user_id}` : `IP: ${fb.ip_address}`;
                const statusBadge = fb.status === 'pending' 
                    ? '<span style="color: #f39c12;">å¾…å¤„ç†</span>' 
                    : '<span style="color: #2ecc71;">å·²å¤„ç†</span>';
                
                return `
                    <tr>
                        <td>${fb.id}</td>
                        <td title="${fb.content.replace(/"/g, '&quot;')}">${contentPreview}</td>
                        <td>${fb.contact || '-'}</td>
                        <td>${userInfo}</td>
                        <td>${statusBadge}</td>
                        <td>${createTime}</td>
                        <td>
                            <button class="btn btn-primary" onclick="viewFeedback(${fb.id})" style="padding: 5px 10px; font-size: 12px;">æŸ¥çœ‹</button>
                            <button class="btn" onclick="deleteFeedback(${fb.id})" style="padding: 5px 10px; font-size: 12px; background: #f44336; color: white;">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // æ¸²æŸ“åˆ†é¡µ
        function renderFeedbackPagination(pagination) {
            const container = document.getElementById('feedback-pagination');
            if (pagination.pages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let html = '';
            if (pagination.page > 1) {
                html += `<button class="btn" onclick="loadFeedbacks(${pagination.page - 1})">ä¸Šä¸€é¡µ</button>`;
            }
            html += `<span style="padding: 8px 16px;">ç¬¬ ${pagination.page} / ${pagination.pages} é¡µï¼ˆå…± ${pagination.total} æ¡ï¼‰</span>`;
            if (pagination.page < pagination.pages) {
                html += `<button class="btn" onclick="loadFeedbacks(${pagination.page + 1})">ä¸‹ä¸€é¡µ</button>`;
            }
            container.innerHTML = html;
        }
        
        // åŠ è½½åé¦ˆåˆ—è¡¨
        async function loadFeedbacks() {
            try {
                const response = await fetch('/admin/api/feedback');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('feedback-stats').innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;">${stats.total_feedbacks}</div>
                                <div style="color: #666; font-size: 14px;">æ€»åé¦ˆæ•°</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #f39c12;">${stats.pending_feedbacks}</div>
                                <div style="color: #666; font-size: 14px;">å¾…å¤„ç†</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #2ecc71;">${stats.processed_feedbacks}</div>
                                <div style="color: #666; font-size: 14px;">å·²å¤„ç†</div>
                            </div>
                            <div>
                                <div style="font-size: 24px; font-weight: bold; color: #e74c3c;">${stats.recent_feedbacks}</div>
                                <div style="color: #666; font-size: 14px;">æœ€è¿‘7å¤©</div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½åé¦ˆç»Ÿè®¡å¤±è´¥', error);
            }
        }
        
        // æŸ¥çœ‹åé¦ˆè¯¦æƒ…
        async function viewFeedback(id) {
            try {
                const response = await fetch(`/admin/api/feedback?page=1&per_page=1000`);
                const data = await response.json();
                
                if (data.success) {
                    const feedback = data.feedbacks.find(f => f.id === id);
                    if (feedback) {
                        currentFeedbackId = id;
                        document.getElementById('feedback-detail-content-text').textContent = feedback.content;
                        document.getElementById('feedback-detail-contact').textContent = feedback.contact || 'æœªæä¾›';
                        document.getElementById('feedback-detail-info').innerHTML = `
                            ç”¨æˆ·ID: ${feedback.user_id || 'æœªç™»å½•'} | IP: ${feedback.ip_address}<br>
                            æäº¤æ—¶é—´: ${new Date(feedback.create_time).toLocaleString('zh-CN')}<br>
                            ${feedback.process_by ? `å¤„ç†äºº: ${feedback.process_by} | å¤„ç†æ—¶é—´: ${new Date(feedback.process_time).toLocaleString('zh-CN')}` : ''}
                        `;
                        document.getElementById('feedback-remark').value = feedback.remark || '';
                        document.getElementById('process-feedback-btn').textContent = feedback.status === 'processed' ? 'æ›´æ–°å¤‡æ³¨' : 'æ ‡è®°ä¸ºå·²å¤„ç†';
                        document.getElementById('feedback-modal').style.display = 'flex';
                    }
                }
            } catch (error) {
                alert('åŠ è½½åé¦ˆè¯¦æƒ…å¤±è´¥');
            }
        }
        
        // å…³é—­åé¦ˆæ¨¡æ€æ¡†
        function closeFeedbackModal() {
            document.getElementById('feedback-modal').style.display = 'none';
            currentFeedbackId = null;
        }
        
        // å¤„ç†åé¦ˆ
        async function processFeedback() {
            if (!currentFeedbackId) return;
            
            const remark = document.getElementById('feedback-remark').value.trim();
            
            try {
                const response = await fetch(`/admin/api/feedback/${currentFeedbackId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        status: 'processed',
                        remark: remark
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('åé¦ˆå·²æ ‡è®°ä¸ºå·²å¤„ç†');
                    closeFeedbackModal();
                    loadFeedbacks(currentFeedbackPage);
                } else {
                    alert(data.error || 'å¤„ç†å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }
        
        // åˆ é™¤åé¦ˆ
        async function deleteFeedback(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤æ­¤åé¦ˆå—ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/api/feedback/${id}`, {method: 'DELETE'});
                const data = await response.json();
                
                if (data.success) {
                    alert('åˆ é™¤æˆåŠŸ');
                    loadFeedbacks(currentFeedbackPage);
                } else {
                    alert(data.error || 'åˆ é™¤å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }
        
        // ========== æ¥å£ç®¡ç†ç›¸å…³å‡½æ•° ==========
        
        // åŠ è½½æ¥å£åˆ—è¡¨
        async function loadInterfaceList() {
            try {
                const response = await fetch('/admin/api/interface-definitions');
                const data = await response.json();
                
                if (data.success) {
                    const definitions = data.definitions || [];
                    let html = '<table style="width: 100%;">';
                    html += '<thead><tr><th>æ¥å£åç§°</th><th>æ˜¾ç¤ºåç§°</th><th>æè¿°</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>';
                    html += '<tbody>';
                    
                    // æ˜¾ç¤ºæ‰€æœ‰æ¥å£ï¼ˆåŒ…æ‹¬å†…ç½®æ¥å£ï¼Œç°åœ¨éƒ½å¯ä»¥ç¼–è¾‘ï¼‰
                    definitions.forEach(def => {
                        html += `<tr>
                            <td><strong>${def.interface_name}</strong></td>
                            <td>${def.display_name}</td>
                            <td>${def.description || '-'}</td>
                            <td>${def.enabled ? '<span style="color: green;">âœ“ å·²å¯ç”¨</span>' : '<span style="color: red;">âœ— å·²ç¦ç”¨</span>'}</td>
                            <td>
                                <button class="btn-success" onclick="editInterface('${def.interface_name}')" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">ç¼–è¾‘</button>
                                <button class="btn-danger" onclick="deleteInterface('${def.interface_name}')" style="padding: 5px 10px; font-size: 12px;">åˆ é™¤</button>
                            </td>
                        </tr>`;
                    });
                    
                    html += '</tbody></table>';
                    document.getElementById('interface-list-content').innerHTML = html;
                } else {
                    document.getElementById('interface-list-content').innerHTML = '<p style="color: red;">åŠ è½½å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯') + '</p>';
                }
            } catch (error) {
                document.getElementById('interface-list-content').innerHTML = '<p style="color: red;">ç½‘ç»œé”™è¯¯: ' + error.message + '</p>';
            }
        }
        
        // æ˜¾ç¤ºæ·»åŠ æ¥å£è¡¨å•
        function showInterfaceForm() {
            document.getElementById('interface-modal-title').textContent = 'æ·»åŠ æ–°æ¥å£';
            document.getElementById('interface-form').reset();
            document.getElementById('interface-name').removeAttribute('readonly');
            document.getElementById('interface-name-old').value = '';
            // é‡ç½®URLé…ç½®æ–¹æ³•ä¸ºGET
            document.getElementById('url-search-method').value = 'GET';
            document.getElementById('url-chapters-method').value = 'GET';
            document.getElementById('url-audio-method').value = 'GET';
            
            // æ¸…ç©ºå¹¶åˆå§‹åŒ–å­—æ®µæ˜ å°„å®¹å™¨
            const searchContainer = document.getElementById('search-fields-container');
            searchContainer.innerHTML = '';
            searchFieldCounter = 0;
            addSearchField('', ''); // æ·»åŠ ä¸€è¡Œç©ºå­—æ®µ
            
            const chaptersContainer = document.getElementById('chapters-fields-container');
            chaptersContainer.innerHTML = '';
            chaptersFieldCounter = 0;
            addChaptersField('', '', 'auto'); // æ·»åŠ ä¸€è¡Œç©ºå­—æ®µ
            
            document.getElementById('interface-modal').style.display = 'flex';
        }
        
        // ç¼–è¾‘æ¥å£ï¼ˆåŒ…æ‹¬å†…ç½®æ¥å£ï¼‰
        async function editInterface(interfaceName) {
            try {
                const response = await fetch('/admin/api/interface-definitions');
                const data = await response.json();
                let def = data.definitions.find(d => d.interface_name === interfaceName);
                
                // å¦‚æœæ¥å£å®šä¹‰ä¸å­˜åœ¨ï¼ˆå¯èƒ½æ˜¯å†…ç½®æ¥å£é¦–æ¬¡ç¼–è¾‘ï¼‰ï¼Œå°è¯•åŠ è½½
                if (!def && ['lam', 'tt'].includes(interfaceName)) {
                    // è§¦å‘ä¸€æ¬¡æ¥å£é€‚é…å™¨åŠ è½½ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºé»˜è®¤é…ç½®
                    try {
                        await fetch(`/api/interfaces/list`);  // è§¦å‘åŠ è½½
                        // é‡æ–°è·å–æ¥å£åˆ—è¡¨
                        const reloadResponse = await fetch('/admin/api/interface-definitions');
                        const reloadData = await reloadResponse.json();
                        if (reloadData.success) {
                            def = reloadData.definitions.find(d => d.interface_name === interfaceName);
                        }
                    } catch (e) {
                        console.error('åŠ è½½æ¥å£é…ç½®å¤±è´¥:', e);
                    }
                }
                
                if (!def) {
                    alert('æ¥å£ä¸å­˜åœ¨æˆ–æ— æ³•åŠ è½½é…ç½®');
                    return;
                }
                
                // å¡«å……è¡¨å•
                document.getElementById('interface-modal-title').textContent = 'ç¼–è¾‘æ¥å£: ' + interfaceName;
                document.getElementById('interface-name').value = def.interface_name;
                document.getElementById('interface-name').setAttribute('readonly', 'readonly');
                document.getElementById('interface-name-old').value = def.interface_name;
                document.getElementById('interface-display-name').value = def.display_name;
                document.getElementById('interface-description').value = def.description || '';
                document.getElementById('interface-enabled').checked = def.enabled;
                
                // å¡«å……å­—æ®µæ˜ å°„
                const mapping = def.field_mapping || {};
                const search = mapping.search || {};
                const chapters = mapping.chapters || {};
                const url = mapping.url || {};
                
                // æœç´¢å­—æ®µæ˜ å°„
                document.getElementById('field-search-success-field').value = search.success_field || '';
                document.getElementById('field-search-success-value').value = search.success_value !== undefined ? search.success_value : '';
                document.getElementById('field-search-data-path').value = search.data_path || '';
                
                // æ¸…ç©ºå¹¶é‡æ–°åŠ è½½æœç´¢å­—æ®µ
                const searchContainer = document.getElementById('search-fields-container');
                searchContainer.innerHTML = '';
                searchFieldCounter = 0;
                if (search.fields && Object.keys(search.fields).length > 0) {
                    for (const [key, value] of Object.entries(search.fields)) {
                        addSearchField(key, value);
                    }
                } else {
                    // å¦‚æœæ²¡æœ‰å­—æ®µï¼Œè‡³å°‘æ·»åŠ ä¸€è¡Œç©ºçš„
                    addSearchField('', '');
                }
                
                // ç« èŠ‚å­—æ®µæ˜ å°„
                document.getElementById('field-chapters-success-field').value = chapters.success_field || '';
                document.getElementById('field-chapters-success-value').value = chapters.success_value !== undefined ? chapters.success_value : '';
                document.getElementById('field-chapters-data-path').value = chapters.data_path || '';
                
                // æ¸…ç©ºå¹¶é‡æ–°åŠ è½½ç« èŠ‚å­—æ®µ
                const chaptersContainer = document.getElementById('chapters-fields-container');
                chaptersContainer.innerHTML = '';
                chaptersFieldCounter = 0;
                if (chapters.chapter_fields && Object.keys(chapters.chapter_fields).length > 0) {
                    for (const [key, value] of Object.entries(chapters.chapter_fields)) {
                        if (key === 'duration_format') continue; // duration_formatå•ç‹¬å¤„ç†
                        const formatValue = chapters.chapter_fields.duration_format || 'auto';
                        addChaptersField(key, value, key === 'duration' ? formatValue : 'auto');
                    }
                } else {
                    // å¦‚æœæ²¡æœ‰å­—æ®µï¼Œè‡³å°‘æ·»åŠ ä¸€è¡Œç©ºçš„
                    addChaptersField('', '', 'auto');
                }
                
                // URLå­—æ®µæ˜ å°„
                document.getElementById('field-url-success-field').value = url.success_field || '';
                document.getElementById('field-url-success-value').value = url.success_value !== undefined ? url.success_value : '';
                document.getElementById('field-url-url-field').value = url.url_field || '';
                
                // åŠ è½½URLé…ç½®
                try {
                    // å†…ç½®æ¥å£çš„é»˜è®¤URLé…ç½®
                    const defaultUrls = {
                        'lam': {
                            'search': 'https://app.365ting.com/listen/Apitzg2025/appSearch?app_token=abcSEARCH-2025&client=babala-android&search={keyword}',
                            'chapters': 'https://app.365ting.com/listen/Apitzg2025/chapter?bookId={bookId}&page={page}&size={size}&sort=asc',
                            'url': 'https://app.365ting.com/listen/Apitzg2025/AppGetChapterUrl2023?addItParapet=502aa1c2730221d52c71fa3359425e52&bookId={bookId}&chapterId={chapterId}&timeStamp={timestamp}&uid='
                        },
                        'tt': {
                            'search': 'https://sdkapi.hhlqilongzhu.cn/api/ximalaya/?key=DragonD4E8CEDD0B41A3B59B777BE08933F65B&name={keyword}',
                            'chapters': 'https://mobile.ximalaya.com/mobile/v1/album/track/ts-{timestamp}?albumId={bookId}&pageId={page}&pageSize={size}&device=android&isAsc=true',
                            'url': 'https://sdkapi.hhlqilongzhu.cn/api/ximalaya/?key=DragonD4E8CEDD0B41A3B59B777BE08933F65B&trackId={trackId}'
                        }
                    };
                    
                    const urlConfigResponse = await fetch('/admin/api/api-config');
                    const urlConfigData = await urlConfigResponse.json();
                    if (urlConfigData.success) {
                        const configs = urlConfigData.configs;
                        const searchConfig = configs[`${interfaceName}_search`] || {};
                        const chaptersConfig = configs[`${interfaceName}_chapters`] || {};
                        const audioConfig = configs[`${interfaceName}_url`] || {};
                        
                        // å¡«å……URLé…ç½®ï¼Œå¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰é…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆä»…å¯¹å†…ç½®æ¥å£ï¼‰
                        const defaultSearchUrl = defaultUrls[interfaceName]?.search || '';
                        const defaultChaptersUrl = defaultUrls[interfaceName]?.chapters || '';
                        const defaultAudioUrl = defaultUrls[interfaceName]?.url || '';
                        
                        document.getElementById('url-search-url').value = searchConfig._url || searchConfig.url || defaultSearchUrl;
                        document.getElementById('url-search-method').value = searchConfig.method || 'GET';
                        document.getElementById('url-chapters-url').value = chaptersConfig._url || chaptersConfig.url || defaultChaptersUrl;
                        document.getElementById('url-chapters-method').value = chaptersConfig.method || 'GET';
                        document.getElementById('url-audio-url').value = audioConfig._url || audioConfig.url || defaultAudioUrl;
                        document.getElementById('url-audio-method').value = audioConfig.method || 'GET';
                    }
                } catch (error) {
                    console.error('åŠ è½½URLé…ç½®å¤±è´¥:', error);
                    // å³ä½¿åŠ è½½å¤±è´¥ï¼Œä¹Ÿå°è¯•ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆä»…å¯¹å†…ç½®æ¥å£ï¼‰
                    const defaultUrls = {
                        'lam': {
                            'search': 'https://app.365ting.com/listen/Apitzg2025/appSearch?app_token=abcSEARCH-2025&client=babala-android&search={keyword}',
                            'chapters': 'https://app.365ting.com/listen/Apitzg2025/chapter?bookId={bookId}&page={page}&size={size}&sort=asc',
                            'url': 'https://app.365ting.com/listen/Apitzg2025/AppGetChapterUrl2023?addItParapet=502aa1c2730221d52c71fa3359425e52&bookId={bookId}&chapterId={chapterId}&timeStamp={timestamp}&uid='
                        },
                        'tt': {
                            'search': 'https://sdkapi.hhlqilongzhu.cn/api/ximalaya/?key=DragonD4E8CEDD0B41A3B59B777BE08933F65B&name={keyword}',
                            'chapters': 'https://mobile.ximalaya.com/mobile/v1/album/track/ts-{timestamp}?albumId={bookId}&pageId={page}&pageSize={size}&device=android&isAsc=true',
                            'url': 'https://sdkapi.hhlqilongzhu.cn/api/ximalaya/?key=DragonD4E8CEDD0B41A3B59B777BE08933F65B&trackId={trackId}'
                        }
                    };
                    if (defaultUrls[interfaceName]) {
                        document.getElementById('url-search-url').value = defaultUrls[interfaceName].search;
                        document.getElementById('url-chapters-url').value = defaultUrls[interfaceName].chapters;
                        document.getElementById('url-audio-url').value = defaultUrls[interfaceName].url;
                    }
                }
                
                document.getElementById('interface-modal').style.display = 'flex';
            } catch (error) {
                alert('åŠ è½½æ¥å£ä¿¡æ¯å¤±è´¥: ' + error.message);
            }
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeInterfaceModal() {
            document.getElementById('interface-modal').style.display = 'none';
        }
        
        // ä¿å­˜æ¥å£è¡¨å•æäº¤ï¼ˆåœ¨DOMåŠ è½½åç»‘å®šï¼‰
        function bindInterfaceFormSubmit() {
            const form = document.getElementById('interface-form');
            if (form) {
                form.onsubmit = async function(e) {
                    e.preventDefault();
                    
                    const interfaceName = document.getElementById('interface-name').value.trim();
                    const oldName = document.getElementById('interface-name-old').value;
                    const displayName = document.getElementById('interface-display-name').value.trim();
                    const description = document.getElementById('interface-description').value.trim();
                    const enabled = document.getElementById('interface-enabled').checked;
                    
                    if (!interfaceName || !displayName) {
                        alert('æ¥å£åç§°å’Œæ˜¾ç¤ºåç§°ä¸èƒ½ä¸ºç©º');
                        return;
                    }
                    
                    // éªŒè¯æ¥å£åç§°æ ¼å¼
                    if (!/^[a-zA-Z0-9_]+$/.test(interfaceName)) {
                        alert('æ¥å£åç§°åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿');
                        return;
                    }
                    
                    // éªŒè¯URLé…ç½®
                    const searchUrl = document.getElementById('url-search-url').value.trim();
                    const chaptersUrl = document.getElementById('url-chapters-url').value.trim();
                    const audioUrl = document.getElementById('url-audio-url').value.trim();
                    
                    if (!searchUrl) {
                        alert('è¯·è‡³å°‘å¡«å†™æœç´¢æ¥å£URL');
                        return;
                    }
                    
                    // æ„å»ºå­—æ®µæ˜ å°„
                    const fieldMapping = {
                        search: {
                            success_field: document.getElementById('field-search-success-field').value.trim() || undefined,
                            success_value: parseFieldValue(document.getElementById('field-search-success-value').value.trim()),
                            data_path: document.getElementById('field-search-data-path').value.trim() || undefined,
                            fields: {}
                        },
                        chapters: {
                            success_field: document.getElementById('field-chapters-success-field').value.trim() || undefined,
                            success_value: parseFieldValue(document.getElementById('field-chapters-success-value').value.trim()),
                            data_path: document.getElementById('field-chapters-data-path').value.trim() || undefined,
                            chapter_fields: {}
                        },
                        url: {
                            success_field: document.getElementById('field-url-success-field').value.trim() || undefined,
                            success_value: parseFieldValue(document.getElementById('field-url-success-value').value.trim()),
                            url_field: document.getElementById('field-url-url-field').value.trim() || undefined
                        }
                    };
                    
                    // ä»åŠ¨æ€å­—æ®µå®¹å™¨ä¸­è¯»å–æœç´¢å­—æ®µæ˜ å°„
                    const searchFieldRows = document.querySelectorAll('#search-fields-container > div');
                    searchFieldRows.forEach(row => {
                        const key = getSearchFieldKey(row);
                        const valueInput = row.querySelector('.search-field-value');
                        if (valueInput) {
                            const value = valueInput.value.trim();
                            if (key && value) {
                                fieldMapping.search.fields[key] = value;
                            }
                        }
                    });
                    
                    // ä»åŠ¨æ€å­—æ®µå®¹å™¨ä¸­è¯»å–ç« èŠ‚å­—æ®µæ˜ å°„
                    const chaptersFieldRows = document.querySelectorAll('#chapters-fields-container > div');
                    let durationFormat = 'auto';
                    chaptersFieldRows.forEach(row => {
                        const key = getChaptersFieldKey(row);
                        const valueInput = row.querySelector('.chapters-field-value');
                        const formatSelect = row.querySelector('.chapters-field-format');
                        if (valueInput) {
                            const value = valueInput.value.trim();
                            if (key && value) {
                                fieldMapping.chapters.chapter_fields[key] = value;
                                // å¦‚æœæ˜¯durationå­—æ®µï¼Œä¿å­˜format
                                if (key === 'duration' && formatSelect) {
                                    durationFormat = formatSelect.value;
                                }
                            }
                        }
                    });
                    // å¦‚æœæœ‰durationå­—æ®µï¼Œæ·»åŠ duration_format
                    if (fieldMapping.chapters.chapter_fields.duration) {
                        fieldMapping.chapters.chapter_fields.duration_format = durationFormat;
                    }
                    
                    // æ¸…ç†ç©ºå€¼
                    Object.keys(fieldMapping).forEach(key => {
                        Object.keys(fieldMapping[key]).forEach(subKey => {
                            if (fieldMapping[key][subKey] === undefined || fieldMapping[key][subKey] === '') {
                                delete fieldMapping[key][subKey];
                            }
                        });
                    });
                    
                    try {
                        // å…ˆä¿å­˜æ¥å£å®šä¹‰
                        const url = oldName ? `/admin/api/interface-definitions/${interfaceName}` : '/admin/api/interface-definitions';
                        const method = oldName ? 'PUT' : 'POST';
                        
                        const response = await fetch(url, {
                            method: method,
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                interface_name: interfaceName,
                                display_name: displayName,
                                description: description,
                                enabled: enabled,
                                field_mapping: Object.keys(fieldMapping.search).length > 0 || 
                                             Object.keys(fieldMapping.chapters).length > 0 || 
                                             Object.keys(fieldMapping.url).length > 0 ? fieldMapping : undefined
                            })
                        });
                        
                        const data = await response.json();
                        if (!data.success) {
                            alert(data.error || 'ä¿å­˜æ¥å£å®šä¹‰å¤±è´¥');
                            return;
                        }
                        
                        // ä¿å­˜URLé…ç½®
                        const urlConfigs = [];
                        if (searchUrl) {
                            urlConfigs.push({
                                interface: interfaceName,
                                config_type: 'search',
                                config: {
                                    url: searchUrl,
                                    method: document.getElementById('url-search-method').value
                                }
                            });
                        }
                        if (chaptersUrl) {
                            urlConfigs.push({
                                interface: interfaceName,
                                config_type: 'chapters',
                                config: {
                                    url: chaptersUrl,
                                    method: document.getElementById('url-chapters-method').value
                                }
                            });
                        }
                        if (audioUrl) {
                            urlConfigs.push({
                                interface: interfaceName,
                                config_type: 'url',
                                config: {
                                    url: audioUrl,
                                    method: document.getElementById('url-audio-method').value
                                }
                            });
                        }
                        
                        // ä¾æ¬¡ä¿å­˜URLé…ç½®
                        let allSuccess = true;
                        for (const urlConfig of urlConfigs) {
                            try {
                                const urlResponse = await fetch('/admin/api/api-config', {
                                    method: 'POST',
                                    headers: {'Content-Type': 'application/json'},
                                    body: JSON.stringify(urlConfig)
                                });
                                const urlData = await urlResponse.json();
                                if (!urlData.success) {
                                    allSuccess = false;
                                    console.error('ä¿å­˜URLé…ç½®å¤±è´¥:', urlConfig.config_type, urlData.error);
                                }
                            } catch (error) {
                                allSuccess = false;
                                console.error('ä¿å­˜URLé…ç½®é”™è¯¯:', urlConfig.config_type, error);
                            }
                        }
                        
                        if (allSuccess) {
                            alert('æ¥å£ä¿å­˜æˆåŠŸï¼åŒ…æ‹¬æ¥å£å®šä¹‰å’ŒURLé…ç½®ã€‚');
                        } else {
                            alert('æ¥å£å®šä¹‰å·²ä¿å­˜ï¼Œä½†éƒ¨åˆ†URLé…ç½®ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥"æ¥å£URLé…ç½®"æ ‡ç­¾é¡µã€‚');
                        }
                        
                        closeInterfaceModal();
                        loadInterfaceList();
                    } catch (error) {
                        alert('ç½‘ç»œé”™è¯¯: ' + error.message);
                    }
                };
            }
        }
        
        // åŠ¨æ€å­—æ®µç®¡ç† - æœç´¢å­—æ®µ
        let searchFieldCounter = 0;
        
        function addSearchField(key = '', value = '') {
            const container = document.getElementById('search-fields-container');
            const fieldId = `search-field-${searchFieldCounter++}`;
            const fieldRow = document.createElement('div');
            fieldRow.id = fieldId;
            fieldRow.style.display = 'flex';
            fieldRow.style.gap = '8px';
            fieldRow.style.alignItems = 'center';
            
            // æ ‡å‡†å­—æ®µååˆ—è¡¨ï¼ˆæœç´¢æ¥å£ï¼‰
            const standardFields = ['id', 'bookTitle', 'bookName', 'bookAnchor', 'bookImage', 'bookDesc', 'count', 'heat'];
            const optionsHtml = standardFields.map(f => `<option value="${f}" ${f === key ? 'selected' : ''}>${f}</option>`).join('');
            
            fieldRow.innerHTML = `
                <select class="search-field-key" style="width: 150px; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                    <option value="">-- é€‰æ‹©æ ‡å‡†å­—æ®µ --</option>
                    ${optionsHtml}
                    <option value="__custom__" ${!standardFields.includes(key) && key ? 'selected' : ''}>è‡ªå®šä¹‰å­—æ®µ...</option>
                </select>
                <input type="text" class="search-field-key-custom" placeholder="è‡ªå®šä¹‰æ ‡å‡†å­—æ®µå" value="${!standardFields.includes(key) && key ? key : ''}" style="display: ${!standardFields.includes(key) && key ? 'block' : 'none'}; flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                <span>:</span>
                <input type="text" class="search-field-value" placeholder="æ¥å£è¿”å›å­—æ®µåï¼ˆå‚è€ƒæ¥å£è¿”å›å€¼ï¼‰" value="${value}" style="flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                <button type="button" onclick="removeSearchField('${fieldId}')" style="padding: 5px 10px; background: #e74c3c; color: white; border: none; border-radius: 3px; cursor: pointer;">åˆ é™¤</button>
            `;
            container.appendChild(fieldRow);
            
            // ç»‘å®šä¸‹æ‹‰æ¡†å˜åŒ–äº‹ä»¶
            const select = fieldRow.querySelector('.search-field-key');
            const customInput = fieldRow.querySelector('.search-field-key-custom');
            select.addEventListener('change', function() {
                if (this.value === '__custom__') {
                    customInput.style.display = 'block';
                    customInput.focus();
                } else {
                    customInput.style.display = 'none';
                    customInput.value = '';
                }
            });
        }
        
        // è·å–æœç´¢å­—æ®µçš„å®é™…é”®åï¼ˆä»selectæˆ–custom inputï¼‰
        function getSearchFieldKey(row) {
            const select = row.querySelector('.search-field-key');
            const customInput = row.querySelector('.search-field-key-custom');
            if (select.value === '__custom__') {
                return customInput.value.trim();
            }
            return select.value;
        }
        
        function removeSearchField(fieldId) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.remove();
            }
        }
        
        // åŠ¨æ€å­—æ®µç®¡ç† - ç« èŠ‚å­—æ®µ
        let chaptersFieldCounter = 0;
        
        function addChaptersField(key = '', value = '', durationFormat = 'auto') {
            const container = document.getElementById('chapters-fields-container');
            const fieldId = `chapters-field-${chaptersFieldCounter++}`;
            const fieldRow = document.createElement('div');
            fieldRow.id = fieldId;
            fieldRow.style.display = 'flex';
            fieldRow.style.gap = '8px';
            fieldRow.style.alignItems = 'center';
            
            // æ ‡å‡†å­—æ®µååˆ—è¡¨ï¼ˆç« èŠ‚æ¥å£ï¼‰
            const standardFields = ['chapter_id', 'title', 'duration', 'order'];
            const optionsHtml = standardFields.map(f => `<option value="${f}" ${f === key ? 'selected' : ''}>${f}</option>`).join('');
            const isDuration = key === 'duration';
            
            // ç‰¹æ®Šå¤„ç†durationå­—æ®µï¼Œéœ€è¦æ˜¾ç¤ºæ ¼å¼é€‰æ‹©
            const valueInput = isDuration 
                ? `<input type="text" class="chapters-field-value" placeholder="æ¥å£è¿”å›å­—æ®µåï¼ˆå‚è€ƒæ¥å£è¿”å›å€¼ï¼‰" value="${value}" style="flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                   <select class="chapters-field-format" style="width: 120px; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                       <option value="auto" ${durationFormat === 'auto' ? 'selected' : ''}>è‡ªåŠ¨è¯†åˆ«</option>
                       <option value="string" ${durationFormat === 'string' ? 'selected' : ''}>å­—ç¬¦ä¸²</option>
                       <option value="seconds" ${durationFormat === 'seconds' ? 'selected' : ''}>ç§’æ•°</option>
                   </select>`
                : `<input type="text" class="chapters-field-value" placeholder="æ¥å£è¿”å›å­—æ®µåï¼ˆå‚è€ƒæ¥å£è¿”å›å€¼ï¼‰" value="${value}" style="flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">`;
            
            fieldRow.innerHTML = `
                <select class="chapters-field-key" style="width: 150px; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                    <option value="">-- é€‰æ‹©æ ‡å‡†å­—æ®µ --</option>
                    ${optionsHtml}
                    <option value="__custom__" ${!standardFields.includes(key) && key ? 'selected' : ''}>è‡ªå®šä¹‰å­—æ®µ...</option>
                </select>
                <input type="text" class="chapters-field-key-custom" placeholder="è‡ªå®šä¹‰æ ‡å‡†å­—æ®µå" value="${!standardFields.includes(key) && key ? key : ''}" style="display: ${!standardFields.includes(key) && key ? 'block' : 'none'}; flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                <span>:</span>
                ${valueInput}
                <button type="button" onclick="removeChaptersField('${fieldId}')" style="padding: 5px 10px; background: #e74c3c; color: white; border: none; border-radius: 3px; cursor: pointer;">åˆ é™¤</button>
            `;
            container.appendChild(fieldRow);
            
            // ç»‘å®šä¸‹æ‹‰æ¡†å˜åŒ–äº‹ä»¶
            const select = fieldRow.querySelector('.chapters-field-key');
            const customInput = fieldRow.querySelector('.chapters-field-key-custom');
            if (select) {
                select.addEventListener('change', function() {
                    if (this.value === '__custom__') {
                        if (customInput) {
                            customInput.style.display = 'block';
                            customInput.focus();
                        }
                    } else {
                        if (customInput) {
                            customInput.style.display = 'none';
                            customInput.value = '';
                        }
                        // å¦‚æœé€‰æ‹©çš„æ˜¯durationï¼Œéœ€è¦æ˜¾ç¤ºæ ¼å¼é€‰æ‹©å™¨
                        if (this.value === 'duration') {
                            const formatSelect = fieldRow.querySelector('.chapters-field-format');
                            if (!formatSelect) {
                                const valueInput = fieldRow.querySelector('.chapters-field-value');
                                const formatHtml = `<select class="chapters-field-format" style="width: 120px; padding: 5px; border: 1px solid #ddd; border-radius: 3px;">
                                    <option value="auto" selected>è‡ªåŠ¨è¯†åˆ«</option>
                                    <option value="string">å­—ç¬¦ä¸²</option>
                                    <option value="seconds">ç§’æ•°</option>
                                </select>`;
                                valueInput.insertAdjacentHTML('afterend', formatHtml);
                            }
                        } else {
                            const formatSelect = fieldRow.querySelector('.chapters-field-format');
                            if (formatSelect) {
                                formatSelect.remove();
                            }
                        }
                    }
                });
            }
        }
        
        // è·å–ç« èŠ‚å­—æ®µçš„å®é™…é”®åï¼ˆä»selectæˆ–custom inputï¼‰
        function getChaptersFieldKey(row) {
            const select = row.querySelector('.chapters-field-key');
            const customInput = row.querySelector('.chapters-field-key-custom');
            if (select && select.value === '__custom__') {
                return customInput ? customInput.value.trim() : '';
            }
            return select ? select.value : '';
        }
        
        function removeChaptersField(fieldId) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.remove();
            }
        }
        
        // è§£æå­—æ®µæ˜ å°„ï¼ˆæ”¯æŒ "æ ‡å‡†å­—æ®µ: æ¥å£å­—æ®µ" æ ¼å¼æˆ–ç›´æ¥è¾“å…¥å­—æ®µåï¼‰
        function parseFieldMapping(value) {
            if (!value) return undefined;
            if (value.includes(':')) {
                return value.split(':')[1].trim();
            }
            return value.trim();
        }
        
        // è§£æå­—æ®µå€¼ï¼ˆå°è¯•è½¬æ¢ä¸ºæ•°å­—æˆ–å¸ƒå°”å€¼ï¼‰
        function parseFieldValue(value) {
            if (!value) return undefined;
            if (value === 'true') return true;
            if (value === 'false') return false;
            if (/^\d+$/.test(value)) return parseInt(value);
            return value;
        }
        
        // ================= ç”¨æˆ·ç®¡ç† =================
        async function loadUsers() {
            const tbody = document.querySelector('#users-table tbody');
            if (!tbody) return;
            tbody.innerHTML = '<tr><td colspan="5">åŠ è½½ä¸­...</td></tr>';
            try {
                const resp = await fetch('/admin/api/users');
                const data = await resp.json();
                if (!data.success) {
                    tbody.innerHTML = `<tr><td colspan="5" style="color:red;">${data.error || 'åŠ è½½å¤±è´¥'}</td></tr>`;
                    return;
                }
                const users = data.users || [];
                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5">æš‚æ— ç”¨æˆ·</td></tr>';
                    return;
                }
                tbody.innerHTML = users.map(u => {
                    const isAdmin = u.is_admin;
                    const safeTime = u.register_time ? new Date(u.register_time).toLocaleString() : '-';
                    const deleteBtn = isAdmin
                        ? '<span style="color:#888;">è¶…çº§ç®¡ç†å‘˜</span>'
                        : `<button class="btn-danger" onclick="deleteUser(${u.id})">åˆ é™¤</button>`;
                    return `
                        <tr>
                            <td>${u.id}</td>
                            <td>${u.username}</td>
                            <td>${safeTime}</td>
                            <td>${isAdmin ? 'è¶…çº§ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}</td>
                            <td>${deleteBtn}</td>
                        </tr>
                    `;
                }).join('');
            } catch (e) {
                console.error('åŠ è½½ç”¨æˆ·å¤±è´¥', e);
                tbody.innerHTML = '<tr><td colspan="5" style="color:red;">åŠ è½½å¤±è´¥</td></tr>';
            }
        }

        function openUserModal() {
            const modal = document.getElementById('user-modal');
            if (!modal) return;
            document.getElementById('user-username').value = '';
            document.getElementById('user-password').value = '';
            document.getElementById('user-password-confirm').value = '';
            modal.style.display = 'flex';
        }

        function closeUserModal() {
            const modal = document.getElementById('user-modal');
            if (modal) modal.style.display = 'none';
        }

        async function handleUserFormSubmit(event) {
            event.preventDefault();
            const username = document.getElementById('user-username').value.trim();
            const password = document.getElementById('user-password').value.trim();
            const passwordConfirm = document.getElementById('user-password-confirm').value.trim();
            
            if (!username) {
                alert('è¯·è¾“å…¥ç”¨æˆ·å');
                return;
            }
            if (!password || password.length < 6) {
                alert('å¯†ç è‡³å°‘6ä½');
                return;
            }
            if (password !== passwordConfirm) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }
            try {
                const resp = await fetch('/admin/api/users', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username, password })
                });
                const data = await resp.json();
                if (data.success) {
                    alert('ç”¨æˆ·åˆ›å»ºæˆåŠŸ');
                    closeUserModal();
                    loadUsers();
                } else {
                    alert(data.error || 'åˆ›å»ºå¤±è´¥');
                }
            } catch (e) {
                console.error('åˆ›å»ºç”¨æˆ·å¤±è´¥', e);
                alert('ç½‘ç»œé”™è¯¯ï¼Œåˆ›å»ºå¤±è´¥');
            }
        }

        async function deleteUser(userId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿè¯¥ç”¨æˆ·çš„ä¹¦æ¶/å†å²ç­‰æ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ã€‚')) return;
            try {
                const resp = await fetch(`/admin/api/users/${userId}`, { method: 'DELETE' });
                const data = await resp.json();
                if (data.success) {
                    alert('å·²åˆ é™¤');
                    loadUsers();
                } else {
                    alert(data.error || 'åˆ é™¤å¤±è´¥');
                }
            } catch (e) {
                console.error('åˆ é™¤ç”¨æˆ·å¤±è´¥', e);
                alert('ç½‘ç»œé”™è¯¯ï¼Œåˆ é™¤å¤±è´¥');
            }
        }
        
        // åˆ é™¤æ¥å£
        async function deleteInterface(interfaceName) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤æ¥å£ "${interfaceName}" å—ï¼Ÿ\n\nè¿™å°†åŒæ—¶åˆ é™¤è¯¥æ¥å£çš„æ‰€æœ‰URLé…ç½®ã€‚`)) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/api/interface-definitions/${interfaceName}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('åˆ é™¤æˆåŠŸ');
                    loadInterfaceList();
                } else {
                    alert(data.error || 'åˆ é™¤å¤±è´¥');
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯: ' + error.message);
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            bindInterfaceFormSubmit();
            loadStats();
            loadUsers();
            
            const userForm = document.getElementById('user-form');
            if (userForm) {
                userForm.addEventListener('submit', handleUserFormSubmit);
            }
        });
    </script>
</body>
</html>


